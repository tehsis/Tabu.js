/**
 * Commands for building the project.
 * More info: http://www.volojs.org/ 
**/

module.exports = {
    cleanfrontend: {
        summary: "Removes frontend build files.",
        run: "v.rm tabu-built/public"
    },

    clean: {
        summary: "Removes the generated files.",
        run: "v.rm tabu-built"
    },

    minify: {
        summary: "Minifies the project *.js (using r.js)",
        run: "n.r.js -o build.js out=tabu.js"
    },

    createBuildDir: {
        summary: "Creates the build directory.",
        run: "v.mkdir tabu-built"
    },

    cleanbackend: {
        summary: "Cleans the backend directories.",
        run: [
                "v.rm tabu-built/node_modules",
                "v.rm tabu-built/controllers",
                "v.rm tabu-built/views",
                "v.rm tabu-built/models",
                "v.rm tabu-built/common.js",
                "v.rm tabu-built/index.js",
             ]
    },

    buildbackend: {
        summary: "Builds the backend.",
        depends: ["cleanbackend", "createBuildDir"],
        run: [
                "v.copyDir node_modules tabu-built/node_modules",
                "v.copyDir controllers tabu-built/controllers",
                "v.copyDir views tabu-built/views",
                "v.copyDir models tabu-built/models",
                "v.copyFile common.js tabu-built/common.js",
                "v.copyFile index.js tabu-built/index.js"
             ]
    },

    buildfrontend: {
        summary: "Builds the frontend.",
        depends: ["cleanfrontend", "minify", "createBuildDir"],
        run: [
                "v.mkdir tabu-built/public",
                "v.copyDir public tabu-built/public",
                "v.rm tabu-built/public/javascripts",
                "v.rm tabu-built/public/templates",
                "v.mkdir tabu-built/public/javascripts",
                "v.copyFile public/javascripts/require.js tabu-built/public/javascripts/require.js",
                "v.mv tabu.js tabu-built/public/javascripts/tabu.js"
            ]
    },

    build: {
        summary: "Builds the project and makes it ready to deploy.",
        depends: ["clean", "buildfrontend", "buildbackend"]
    }
}
